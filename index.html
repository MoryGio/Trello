<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <title>Trello</title>
</head>
<body class="bg-gray-100 text-gray-900 font-sans transition-colors duration-300" x-data="gestionTrello" :class="{ 'dark bg-gray-900 text-white': modeSombre }">
    <!-- Barre de navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-sm px-6 py-4 flex justify-between items-center sticky top-0 z-40">
        <div class="flex items-center gap-2">
            <div class="bg-blue-600 p-2 rounded-lg text-white">
                <i data-lucide="trello" class="w-5 h-5"></i>
            </div>
            <h1 class="text-xl font-bold tracking-tight">Trello <span class="text-blue-600 dark:text-blue-400">X</span></h1>
        </div>
        
        <div class="flex items-center gap-4">
            <button @click="modeSombre = !modeSombre" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                <i :data-lucide="modeSombre ? 'sun' : 'moon'" class="w-5 h-5 text-gray-600 dark:text-gray-300"></i>
            </button>
            <button @click="afficherModal = true" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-all">
                <i data-lucide="plus" class="w-4 h-4"></i>
                Nouvelle Tâche
            </button>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="p-6 max-w-7xl mx-auto" x-init="chargerIcones()">
        <!-- Statistiques et Recherche -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div class="flex gap-4">
                <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                    <p class="text-xs font-bold text-gray-500 uppercase mb-1">Total</p>
                    <p class="text-2xl font-bold" x-text="taches.length"></p>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                    <p class="text-xs font-bold text-gray-500 uppercase mb-1">Terminées</p>
                    <p class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="taches.filter(t => t.statut === 'termine').length"></p>
                </div>
            </div>
            <div class="relative w-full md:w-96">
                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                <input 
                    type="text" 
                    placeholder="Rechercher une tâche..."
                    x-model="recherche"
                    class="w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition-all shadow-sm"
                >
            </div>
        </div>

        <!-- Tableau des tâches -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <template x-for="col in colonnes" :key="col.id">
                <div 
                    class="bg-gray-200/50 dark:bg-gray-800/50 rounded-2xl p-4 min-h-[500px] flex flex-col"
                    @dragover.prevent="survolColonne = col.id"
                    @dragleave="survolColonne = null"
                    @drop="deplacerTache(col.id)"
                    :class="survolColonne === col.id ? 'ring-2 ring-blue-500 bg-blue-50/50 dark:bg-blue-900/20' : ''"
                >
                    <div class="flex items-center justify-between mb-4 px-2">
                        <h3 class="font-bold text-gray-700 dark:text-gray-300 uppercase tracking-widest text-xs" x-text="col.titre"></h3>
                        <span class="bg-white dark:bg-gray-700 px-2 py-0.5 rounded-full text-[10px] font-bold" x-text="tachesFiltrees(col.id).length"></span>
                    </div>

                    <div class="space-y-4 flex-1">
                        <template x-for="tache in tachesFiltrees(col.id)" :key="tache.id">
                            <div 
                                class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 cursor-grab active:cursor-grabbing hover:shadow-md transition-all group"
                                draggable="true"
                                @dragstart="tacheEnDrag = tache"
                            >
                                <div class="flex justify-between items-start mb-2">
                                    <span 
                                        class="text-[10px] font-bold uppercase px-2 py-0.5 rounded"
                                        :class="{
                                            'bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300': tache.priorite === 'haute',
                                            'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-300': tache.priorite === 'moyenne',
                                            'bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300': tache.priorite === 'basse'
                                        }"
                                        x-text="tache.priorite === 'haute' ? 'Urgent' : (tache.priorite === 'moyenne' ? 'Normal' : 'Basse')">
                                    </span>
                                    <button @click="supprimerTache(tache.id)" class="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <h4 class="font-bold mb-1" x-text="tache.titre"></h4>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4" x-text="tache.description"></p>
                                <div class="flex items-center gap-1.5 text-gray-400 text-[10px] font-medium border-t border-gray-100 dark:border-gray-700 pt-3">
                                    <i data-lucide="calendar" class="w-3 h-3"></i>
                                    <span x-text="tache.dateEcheance || 'Pas de date'"></span>
                                </div>
                            </div>
                        </template>

                        <!-- État vide -->
                        <div x-show="tachesFiltrees(col.id).length === 0" class="flex-1 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl flex items-center justify-center text-gray-400 py-8">
                            <span class="text-xs font-medium italic opacity-50">Aucune tâche</span>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </main>

    <!-- Fenêtre modale de création -->
    <div x-show="afficherModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" x-cloak x-transition>
        <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-2xl shadow-2xl p-6" @click.outside="afficherModal = false">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">Ajouter une tâche</h2>
                <button @click="afficherModal = false" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <form @submit.prevent="ajouterTache()" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Titre</label>
                    <input x-model="formulaire.titre" type="text" placeholder="Faire mes devoirs..." class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Description</label>
                    <textarea x-model="formulaire.description" rows="3" placeholder="Détails de la tâche..." class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Priorité</label>
                        <select x-model="formulaire.priorite" class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg outline-none">
                            <option value="basse">Basse</option>
                            <option value="moyenne">Moyenne</option>
                            <option value="haute">Haute</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Échéance</label>
                        <input x-model="formulaire.dateEcheance" type="date" class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg outline-none">
                    </div>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition-colors mt-4">
                    Créer la tâche
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('gestionTrello', () => ({
                // Données persistantes
                modeSombre: Alpine.$persist(false),
                taches: Alpine.$persist([]),
                
                // État de l'interface
                recherche: '',
                afficherModal: false,
                tacheEnDrag: null,
                survolColonne: null,
                
                // Formulaire
                formulaire: { titre: '', description: '', priorite: 'moyenne', dateEcheance: '' },
                
                // Structure du tableau
                colonnes: [
                    { id: 'a-faire', titre: 'À Faire' },
                    { id: 'en-cours', titre: 'En Cours' },
                    { id: 'termine', titre: 'Terminé' }
                ],

                // Initialisation
                init() {
                    this.$watch('modeSombre', () => this.chargerIcones());
                    this.chargerIcones();
                },

                // Affichage des icônes Lucide
                chargerIcones() {
                    this.$nextTick(() => { lucide.createIcons(); });
                },

                // Filtrage des tâches selon la colonne et la recherche
                tachesFiltrees(idColonne) {
                    return this.taches.filter(t => {
                        const correspondStatut = t.statut === idColonne;
                        const correspondRecherche = t.titre.toLowerCase().includes(this.recherche.toLowerCase());
                        return correspondStatut && correspondRecherche;
                    });
                },

                // Ajouter une nouvelle tâche
                ajouterTache() {
                    if (!this.formulaire.titre.trim()) return;
                    
                    this.taches.push({
                        id: Date.now(),
                        ...this.formulaire,
                        statut: 'a-faire'
                    });
                    
                    // Réinitialisation
                    this.formulaire = { titre: '', description: '', priorite: 'moyenne', dateEcheance: '' };
                    this.afficherModal = false;
                    this.chargerIcones();
                },

                // Supprimer une tâche
                supprimerTache(id) {
                    this.taches = this.taches.filter(t => t.id !== id);
                },

                // Déplacer une tâche (Drag & Drop)
                deplacerTache(nouveauStatut) {
                    if (!this.tacheEnDrag) return;
                    const index = this.taches.findIndex(t => t.id === this.tacheEnDrag.id);
                    if (index !== -1) {
                        this.taches[index].statut = nouveauStatut;
                    }
                    this.tacheEnDrag = null;
                    this.survolColonne = null;
                }
            }));
        });
    </script>

    <style>
        [x-cloak] { display: none !important; }
    </style>
</body>
</html>